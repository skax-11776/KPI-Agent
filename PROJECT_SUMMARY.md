# KPI Monitoring Agent - í”„ë¡œì íŠ¸ ì „ì²´ ìš”ì•½

## ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”

**í”„ë¡œì íŠ¸ëª…**: KPI Monitoring Agent  
**ëª©ì **: ì œì¡° ë¼ì¸ KPI ëª¨ë‹ˆí„°ë§ ë° AI ê¸°ë°˜ ê·¼ë³¸ ì›ì¸ ë¶„ì„ ì‹œìŠ¤í…œ  
**ê°œë°œ ê¸°ê°„**: 2026ë…„ 2ì›”  
**ë‚´ë¶€ ì „ìš© ì‹œìŠ¤í…œ**: ì™¸ë¶€ ë…¸ì¶œ ì—†ìŒ, ëª¨ë°”ì¼ ì ‘ì† ë¶ˆí•„ìš”

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React Frontend    â”‚ (í¬íŠ¸ 3000)
â”‚  - ëŒ€ì‹œë³´ë“œ          â”‚
â”‚  - ì•ŒëŒ ë¶„ì„         â”‚
â”‚  - AI ì±—ë´‡          â”‚
â”‚  - ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ HTTP REST API
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FastAPI Backend   â”‚ (í¬íŠ¸ 8000)
â”‚  - /api/alarm/*     â”‚
â”‚  - /api/question/*  â”‚
â”‚  - /api/system/*    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
    â†“              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚LangGraph â”‚  â”‚ChromaDB  â”‚
â”‚ 9ê°œ ë…¸ë“œ  â”‚  â”‚RAG 12ê°œ  â”‚ 
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
  â”Œâ”€â”€â”´â”€â”€â”€â”
  â†“      â†“
â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚AWS â”‚ â”‚Supabase â”‚
â”‚Bdrkâ”‚ â”‚PostgreS â”‚
â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### Supabase PostgreSQL (5ê°œ í…Œì´ë¸”)

1. **SCENARIO_MAP** (12 rows)
   - date, alarm_eqp_id, alarm_kpi

2. **RCP_STATE** (24 rows)
   - rcp_id, eqp_id, complex_level

3. **KPI_DAILY** (144 rows)
   - date, eqp_id, line_id, oper_id
   - oee_t, oee_v, thp_t, thp_v
   - tat_t, tat_v, wip_t, wip_v
   - alarm_flag

4. **LOT_STATE** (5771 rows)
   - event_time, lot_id, line_id, oper_id, eqp_id, rcp_id
   - lot_state, in_cnt, hold_cnt, scrap_cnt

5. **EQP_STATE** (3042 rows)
   - event_time, end_time, eqp_id, line_id, oper_id
   - lot_id, rcp_id, eqp_state

### ChromaDB (RAG)
- 12ê°œ ê³¼ê±° ë¶„ì„ ë¦¬í¬íŠ¸ ì €ì¥
- ì„ë² ë”©: AWS Titan Embeddings V2

---

## ğŸ”„ LangGraph ì›Œí¬í”Œë¡œìš°

### ì•ŒëŒ ë¶„ì„ ê²½ë¡œ (9ê°œ ë…¸ë“œ)
```
Node 1: Input Router
  â†“
Node 2: Load Alarm KPI (Supabase ì¡°íšŒ)
  â†“
Node 3: Context Fetch (LOT/EQP/RCP ë°ì´í„° ìˆ˜ì§‘)
  â†“
Node 6: Root Cause Analysis (Claude AI ë¶„ì„)
  â†“
Node 7: Human Choice (ìë™ ì„ íƒ ë˜ëŠ” ìˆ˜ë™)
  â†“
Node 8: Report Writer (Claude AI ë¦¬í¬íŠ¸ ìƒì„±)
  â†“
Node 9: Persist Report (ChromaDB ì €ì¥)
```

### ì§ˆë¬¸ ë‹µë³€ ê²½ë¡œ
```
Node 1: Input Router
  â†“
Node 4: Report Lookup (ChromaDB ê²€ìƒ‰)
  â†“
Node 5: RAG Answer (Claude AI ë‹µë³€ ìƒì„±)
```

---

## ğŸ¨ í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡°

### í˜ì´ì§€
1. **ëŒ€ì‹œë³´ë“œ** (`/`)
   - ì‹¤ì‹œê°„ KPI ëª¨ë‹ˆí„° (0.5ì´ˆ ì—…ë°ì´íŠ¸)
   - ì£¼ê°„ KPI íŠ¸ë Œë“œ ì°¨íŠ¸
   - ì•ŒëŒ ë°œìƒ ë¹ˆë„ ì°¨íŠ¸

2. **ì•ŒëŒ ëª¨ë‹ˆí„°ë§** (`/alarm`)
   - ìµœì‹  ì•ŒëŒ ë¶„ì„ íƒ­
   - ê³¼ê±° ì•ŒëŒ ì´ë ¥ íƒ­ (12ê°œ)

3. **AI ì±—ë´‡** (`/chatbot`)
   - ê³¼ê±° ë¦¬í¬íŠ¸ ê¸°ë°˜ ì§ˆë¬¸ ë‹µë³€

4. **ë°ì´í„°ë² ì´ìŠ¤** (`/database`)
   - 5ê°œ í…Œì´ë¸” ì¡°íšŒ
   - ìºì‹œ í†µê³„ í‘œì‹œ

### UI í…Œë§ˆ
- **ìƒ‰ìƒ**: ë‹¤í¬ ë„¤ì´ë¹„ ë°°ê²½ + ì€ìƒ‰/í°ìƒ‰ í…ìŠ¤íŠ¸
- **ì•¡ì„¼íŠ¸**: ë¸”ë£¨ (#60a5fa)
- **ìŠ¤íƒ€ì¼**: ë¯¸ë˜ì§€í–¥ì  ì—°êµ¬ì†Œ/ì œì–´ì‹¤ ëŠë‚Œ

---

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥

### 1. ì‹¤ì‹œê°„ KPI ëª¨ë‹ˆí„°ë§
- OEE, THP, TAT, WIP 4ê°€ì§€ KPI
- 0.5ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
- ì‹¤ì‹œê°„ ë¼ì¸ ì°¨íŠ¸ (ìµœê·¼ 30ì´ˆ)
- íŠ¸ë Œë“œ í‘œì‹œ (â–²/â–¼)

### 2. AI ê¸°ë°˜ ê·¼ë³¸ ì›ì¸ ë¶„ì„
- AWS Bedrock Claude 3 Haiku ì‚¬ìš©
- 3-5ê°œ ì›ì¸ í›„ë³´ ìƒì„±
- í™•ë¥  ë° ê·¼ê±° ì œì‹œ
- ìë™ ë¦¬í¬íŠ¸ ìƒì„±

### 3. RAG ê¸°ë°˜ ì§ˆë¬¸ ë‹µë³€
- ChromaDB ë²¡í„° ê²€ìƒ‰
- ê³¼ê±° ë¦¬í¬íŠ¸ ì°¸ì¡°
- ìì—°ì–´ ì§ˆë¬¸ ì²˜ë¦¬

### 4. ìºì‹± ì‹œìŠ¤í…œ
- ì•ŒëŒ ë¶„ì„ ê²°ê³¼ ìºì‹± (1ì‹œê°„)
- ì§ˆë¬¸ ë‹µë³€ ìºì‹± (30ë¶„)
- LLM ë¹„ìš© ì ˆê°

### 5. ì§„í–‰ ìƒíƒœ í‘œì‹œ
- 5ë‹¨ê³„ ë¶„ì„ ì§„í–‰ ìƒíƒœ
- ì§„í–‰ë¥  ë°” (0-100%)
- ì˜ˆìƒ ì†Œìš” ì‹œê°„ í‘œì‹œ

---

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

### ë°±ì—”ë“œ
- **ì–¸ì–´**: Python 3.11
- **í”„ë ˆì„ì›Œí¬**: FastAPI
- **ì›Œí¬í”Œë¡œìš°**: LangGraph
- **LLM**: AWS Bedrock (Claude 3 Haiku)
- **ë²¡í„° DB**: ChromaDB
- **ë°ì´í„°ë² ì´ìŠ¤**: Supabase PostgreSQL
- **ìºì‹±**: ì¸ë©”ëª¨ë¦¬ ìºì‹œ (ë”•ì…”ë„ˆë¦¬)

### í”„ë¡ íŠ¸ì—”ë“œ
- **ì–¸ì–´**: TypeScript
- **í”„ë ˆì„ì›Œí¬**: React
- **ì°¨íŠ¸**: Recharts
- **ìŠ¤íƒ€ì¼**: CSS (ì»¤ìŠ¤í…€)
- **HTTP í´ë¼ì´ì–¸íŠ¸**: Axios

### ì¸í”„ë¼
- **í´ë¼ìš°ë“œ**: AWS í”„ë¦¬í‹°ì–´
- **í™˜ê²½ ë³€ìˆ˜**: .env íŒŒì¼

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°
```
AI_Agent_Solo/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ main.py              # FastAPI ì•±
â”‚   â”‚   â”œâ”€â”€ models.py            # Pydantic ëª¨ë¸
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚       â”œâ”€â”€ alarm.py         # ì•ŒëŒ API
â”‚   â”‚       â”œâ”€â”€ question.py      # ì§ˆë¬¸ API
â”‚   â”‚       â””â”€â”€ system.py        # ì‹œìŠ¤í…œ API
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ aws_config.py        # AWS Bedrock
â”‚   â”‚   â”œâ”€â”€ supabase_config.py  # Supabase
â”‚   â”‚   â””â”€â”€ chroma_config.py    # ChromaDB
â”‚   â”œâ”€â”€ graph/
â”‚   â”‚   â”œâ”€â”€ state.py             # State ì •ì˜
â”‚   â”‚   â””â”€â”€ workflow.py          # LangGraph
â”‚   â”œâ”€â”€ nodes/
â”‚   â”‚   â”œâ”€â”€ node_1_input_router.py
â”‚   â”‚   â”œâ”€â”€ node_2_load_alarm_kpi.py
â”‚   â”‚   â”œâ”€â”€ node_3_context_fetch.py
â”‚   â”‚   â”œâ”€â”€ node_4_report_lookup.py
â”‚   â”‚   â”œâ”€â”€ node_5_rag_answer.py
â”‚   â”‚   â”œâ”€â”€ node_6_root_cause_analysis.py
â”‚   â”‚   â”œâ”€â”€ node_7_human_choice.py
â”‚   â”‚   â”œâ”€â”€ node_8_report_writer.py
â”‚   â”‚   â””â”€â”€ node_9_persist_report.py
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ cache.py             # ìºì‹± ì‹œìŠ¤í…œ
â”‚       â”œâ”€â”€ date_utils.py
â”‚       â”œâ”€â”€ data_utils.py
â”‚       â””â”€â”€ prompt_templates.py
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ AlarmAnalysis.tsx
â”‚       â”‚   â”œâ”€â”€ AlarmHistory.tsx
â”‚       â”‚   â”œâ”€â”€ RealtimeKpiMonitor.tsx
â”‚       â”‚   â”œâ”€â”€ KpiTrendChart.tsx
â”‚       â”‚   â”œâ”€â”€ AlarmFrequencyChart.tsx
â”‚       â”‚   â”œâ”€â”€ AnalysisProgress.tsx
â”‚       â”‚   â”œâ”€â”€ ReportViewer.tsx
â”‚       â”‚   â”œâ”€â”€ LoadingSpinner.tsx
â”‚       â”‚   â”œâ”€â”€ CacheStats.tsx
â”‚       â”‚   â””â”€â”€ Sidebar.tsx
â”‚       â”œâ”€â”€ pages/
â”‚       â”‚   â”œâ”€â”€ DashboardOverview.tsx
â”‚       â”‚   â”œâ”€â”€ AlarmPage.tsx
â”‚       â”‚   â”œâ”€â”€ ChatBotPage.tsx
â”‚       â”‚   â””â”€â”€ DatabasePage.tsx
â”‚       â”œâ”€â”€ services/
â”‚       â”‚   â””â”€â”€ api.ts
â”‚       â”œâ”€â”€ types/
â”‚       â”‚   â””â”€â”€ index.ts
â”‚       â””â”€â”€ App.tsx
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ chromadb/                # RAG ë°ì´í„°
â”‚   â””â”€â”€ reports/                 # 11ê°œ PDF
â”œâ”€â”€ venv/                        # Python ê°€ìƒí™˜ê²½
â”œâ”€â”€ .env                         # í™˜ê²½ ë³€ìˆ˜
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

---

## ğŸ”‘ í™˜ê²½ ë³€ìˆ˜ (.env)
```bash
# AWS
AWS_ACCESS_KEY_ID=your_key
AWS_SECRET_ACCESS_KEY=your_secret
AWS_DEFAULT_REGION=us-west-2

# Supabase
SUPABASE_URL=your_url
SUPABASE_KEY=your_key
```

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### ë°±ì—”ë“œ
```bash
cd C:\Users\11786\Desktop\AI_Agent_Solo
.\venv\Scripts\Activate.ps1
python backend/api/main.py
```
â†’ http://localhost:8000

### í”„ë¡ íŠ¸ì—”ë“œ
```bash
cd C:\Users\11786\Desktop\AI_Agent_Solo\frontend
npm start
```
â†’ http://localhost:3000

---

## ğŸ“Š ë°ì´í„° íë¦„

### ì•ŒëŒ ë¶„ì„ íë¦„
1. ì‚¬ìš©ìê°€ "AI ë¶„ì„ ì‹œì‘" ë²„íŠ¼ í´ë¦­
2. í”„ë¡ íŠ¸ì—”ë“œ â†’ POST /api/alarm/analyze
3. ë°±ì—”ë“œ: ìºì‹œ í™•ì¸
4. ìºì‹œ ì—†ìŒ â†’ LangGraph ì›Œí¬í”Œë¡œìš° ì‹¤í–‰
   - Supabaseì—ì„œ KPI ë°ì´í„° ì¡°íšŒ
   - LOT/EQP/RCP ì»¨í…ìŠ¤íŠ¸ ìˆ˜ì§‘
   - Claude AIì— ê·¼ë³¸ ì›ì¸ ë¶„ì„ ìš”ì²­
   - ì‚¬ìš©ìê°€ ì›ì¸ ì„ íƒ (ë˜ëŠ” ìë™)
   - Claude AIì— ë¦¬í¬íŠ¸ ì‘ì„± ìš”ì²­
   - ChromaDBì— ë¦¬í¬íŠ¸ ì €ì¥
5. ê²°ê³¼ë¥¼ ìºì‹œì— ì €ì¥
6. í”„ë¡ íŠ¸ì—”ë“œì— ì‘ë‹µ ë°˜í™˜
7. UIì— ë¶„ì„ ê²°ê³¼ í‘œì‹œ

### ì§ˆë¬¸ ë‹µë³€ íë¦„
1. ì‚¬ìš©ìê°€ ì±—ë´‡ì— ì§ˆë¬¸ ì…ë ¥
2. í”„ë¡ íŠ¸ì—”ë“œ â†’ POST /api/question/answer
3. ë°±ì—”ë“œ: ìºì‹œ í™•ì¸
4. ìºì‹œ ì—†ìŒ â†’ LangGraph ì›Œí¬í”Œë¡œìš° ì‹¤í–‰
   - ì§ˆë¬¸ í•´ì‹œ ìƒì„±
   - ChromaDBì—ì„œ ìœ ì‚¬ ë¦¬í¬íŠ¸ ê²€ìƒ‰
   - Claude AIì— ë‹µë³€ ìƒì„± ìš”ì²­
5. ê²°ê³¼ë¥¼ ìºì‹œì— ì €ì¥
6. í”„ë¡ íŠ¸ì—”ë“œì— ì‘ë‹µ ë°˜í™˜
7. ì±—ë´‡ì— ë‹µë³€ í‘œì‹œ

---

## âš¡ ì„±ëŠ¥ ìµœì í™”

### 1. ìºì‹±
- ì•ŒëŒ ë¶„ì„: 1ì‹œê°„ TTL
- ì§ˆë¬¸ ë‹µë³€: 30ë¶„ TTL
- LLM í˜¸ì¶œ ë¹„ìš© ìµœëŒ€ 90% ì ˆê°

### 2. ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- 0.5ì´ˆ ê°„ê²© (ê¸°ì¡´ 2ì´ˆì—ì„œ ê°œì„ )
- ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜

### 3. ì‘ë‹µ ì†ë„
- ìºì‹œ íˆíŠ¸: < 100ms
- ìºì‹œ ë¯¸ìŠ¤: 40-60ì´ˆ (LLM í˜¸ì¶œ ì‹œê°„)

---

## ğŸ¯ ì£¼ìš” ì˜ì‚¬ê²°ì •

### 1. ë‚´ë¶€ ì „ìš©
- ì¸ì¦/ì¸ê°€ ì‹œìŠ¤í…œ ì—†ìŒ
- Rate limiting ì—†ìŒ
- CORS ì „ì²´ í—ˆìš©
- ë³´ì•ˆë³´ë‹¤ ì‚¬ìš©ì„± ìš°ì„ 

### 2. ìºì‹± ì „ëµ
- Redis ëŒ€ì‹  ì¸ë©”ëª¨ë¦¬ ìºì‹œ (ê°„ë‹¨í•¨)
- ì„œë²„ ì¬ì‹œì‘ ì‹œ ìºì‹œ ì´ˆê¸°í™” (ë¬¸ì œì—†ìŒ)

### 3. UI ë””ìì¸
- ê²€ì€ìƒ‰ + ë„¤ì˜¨ â†’ ë‹¤í¬ ë„¤ì´ë¹„ + ì€ìƒ‰/í°ìƒ‰
- ì—°êµ¬ì†Œ/ì œì–´ì‹¤ ëŠë‚Œ
- ì‹¤ì‹œê°„ ë°ì´í„° ê°•ì¡°

### 4. LLM ì„ íƒ
- Claude 3 Haiku (ë¹ ë¥´ê³  ì €ë ´)
- ê·¼ë³¸ ì›ì¸ ë¶„ì„: 2íšŒ í˜¸ì¶œ
- ì§ˆë¬¸ ë‹µë³€: 1íšŒ í˜¸ì¶œ

---

## ğŸ“ˆ í–¥í›„ ê°œì„  ê°€ëŠ¥ ì‚¬í•­

### ë‹¨ê¸° (ì¶”ê°€ ê°€ëŠ¥)
- [ ] ì•ŒëŒ ì•Œë¦¼ ì‹œìŠ¤í…œ (ë¸Œë¼ìš°ì € ì•Œë¦¼)
- [ ] ì‚¬ìš©ì ì„¤ì • ì €ì¥ (localStorage)
- [ ] ë¦¬í¬íŠ¸ PDF ë‹¤ìš´ë¡œë“œ
- [ ] ë” ë§ì€ ì°¨íŠ¸ ì¶”ê°€

### ì¤‘ê¸° (í•„ìš”ì‹œ)
- [ ] JWT ì¸ì¦ (ì™¸ë¶€ ë…¸ì¶œ ì‹œ)
- [ ] Redis ìºì‹± (ì„œë²„ ì¬ì‹œì‘ ëŒ€ì‘)
- [ ] WebSocket (ì‹¤ì‹œê°„ ì§„í–‰ ìƒíƒœ)
- [ ] Docker ì»¨í…Œì´ë„ˆí™”

### ì¥ê¸° (í™•ì¥ ì‹œ)
- [ ] ë‹¤êµ­ì–´ ì§€ì›
- [ ] ëª¨ë°”ì¼ ì•±
- [ ] ê³ ê¸‰ ë¶„ì„ ëŒ€ì‹œë³´ë“œ
- [ ] ì•ŒëŒ ì˜ˆì¸¡ ê¸°ëŠ¥

---

## ğŸ› ì•Œë ¤ì§„ ì´ìŠˆ ë° í•´ê²°

### 1. workflow_app ì˜¤ë¥˜
**ë¬¸ì œ**: `name 'workflow_app' is not defined`  
**ì›ì¸**: ì „ì—­ ë³€ìˆ˜ ì§ì ‘ ì‚¬ìš©  
**í•´ê²°**: `get_workflow_app()` í•¨ìˆ˜ë¡œ lazy initialization

### 2. ì±—ë´‡ ìŠ¤íƒ€ì¼ ê¹¨ì§
**ë¬¸ì œ**: íŒŒë€ ë°°ê²½, ìŠ¤íƒ€ì¼ ë¯¸ì ìš©  
**ì›ì¸**: CSS ì±—ë´‡ ìŠ¤íƒ€ì¼ ëˆ„ë½  
**í•´ê²°**: index.cssì— ì±—ë´‡ ì „ìš© ìŠ¤íƒ€ì¼ ì¶”ê°€

### 3. Tailwind ì„¤ì • ë¬¸ì œ
**ë¬¸ì œ**: npx tailwindcss init ì‹¤íŒ¨  
**ì›ì¸**: ì„¤ì¹˜ ì˜¤ë¥˜  
**í•´ê²°**: ì»¤ìŠ¤í…€ CSSë¡œ ëŒ€ì²´

---

## ğŸ“ ë¬¸ì˜ ë° ì§€ì›

**ê°œë°œì**: AI Agent ê°œë°œíŒ€  
**ìœ„ì¹˜**: C:\Users\11786\Desktop\AI_Agent_Solo  
**Git**: main ë¸Œëœì¹˜

---

## ğŸ“œ ë¼ì´ì„ ìŠ¤

ë‚´ë¶€ ì „ìš© í”„ë¡œì íŠ¸ - ìƒì—…ì  ì‚¬ìš© ë¶ˆê°€